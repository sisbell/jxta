<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
 <head>
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=iso-8859-1">
  <title>JXTA Coding Conventions</title>
 </head>
 <body link="#6666cc" vlink="#666666" bgcolor="#ffffff">
 
 <h3><FONT COLOR="#800000">Base Standards</font></h3>
 
<p/>All Java code submitted to the JXTA J2SE project must follow the commonly 
accepted Java J2SE coding conventions:
<ul>
<li>JavaSoft <a href="http://java.sun.com/docs/codeconv/">Code Conventions for the Java<sup><font size="-2">TM</font></sup> Programming Language</a></li>
<li><a href="http://java.sun.com/j2se/javadoc/writingdoccomments/index.html">How to Write JavaDoc Comments</a> Guidelines</li>
<li><a href="http://java.sun.com/j2se/javadoc/writingapispecs/index.html">Requirements for Writing Java API Specifications</a></li>
</ul>

<h3><FONT COLOR="#800000">JXTA Coding Convention Extensions</font></h3>

The JXTA J2SE Project has also adopted the following additional conventions to 
make development of the platform simpler:

<ol>
<li><strong>Use Log4J logging levels appropriately</strong>

<p/>Include any exceptions in logging as appropriate and choose the level 
based on:

<p/><table>					
  <tr>
   <td><strong><tt>trace</tt></strong></td>
   <td>"printf" of variables and work-in-progress calculations.</td>
  </tr>
  <tr>
   <td><strong><tt>debug</tt></strong></td>
   <td>Running diagnostics, state information, following program logic.</td>
  </tr>
  <tr>
   <td><strong><tt>info</tt></strong></td>
   <td>Configuration information and module state changes, ie. "module now disabled".</td>
  </tr>
  <tr>
   <td><strong><tt>warning</tt></strong></td>
   <td>Temporary errors, resource exhaustion, non-fatal errors.</td>
  </tr>
  <tr>
   <td><strong><tt>error</tt></strong></td>
   <td>Failed operations without global effects.</td>
  </tr>
  <tr>
   <td><strong><tt>fatal</tt></strong></td>
   <td>Damaged configuration, unable to proceed, errors with global or permanent impacts.</td>
  </tr>
</table>

<p/>Logging an <tt><b>IOException</b></tt> caused by a connection failure:
<pre><tt>
try {
  // some code
} catch ( IOException failure ) {
  if (LOG.isEnabledFor(Priority.WARN)) {
    LOG.warn( "Connection failed", failure );
  }
}
</tt><pre></li>

</li>
<li><strong>Wrap all diagnostic Log4J output in a conditional</strong>

<p/>Log4J leaks memory in its write statements and evaluation of expressions 
in debug statements can be expensive. (Conditional wrapping may be ommited for 
<tt><b>error</b></tt> and <tt><b>fatal</b></tt> level logging since the program 
is likely dead anyway).

<p/><pre><tt>
if (LOG.isEnabledFor(Priority.WARN)) {
  LOG.warn( "This is your final warning." );
}
</tt><pre></li>

<li><strong>Name Every </tt>Thread</tt> and <tt>Timer</tt> you create.</strong>

<p/>Naming threads and timers makes it easier to debug when threads deadlock, 
spin-loop or stall. We also use named <tt>TheadGroup</tt>s to further categorize 
threads (though we use none of the other ThreadGroup features).
</li>

<li><strong>All Thread and TimerTask <tt>run()</tt> methods should have a global 
catch of <tt>Throwable</tt></strong>

<p/>In case any expection gets through unhandled its nice to know that the 
Thread or Timer is dying and why.

<p/><pre><tt>
public run() {

  try {
    // your code
  } catch ( Throwable all ) {
    if (LOG.isEnabledFor(Priority.ERROR)) {
      LOG.error( "Uncaught Throwable in :" + Thread.currentThread().getName(), all );
    }
  }

}
</tt><pre>
</li>

<li><strong>Wrap calls to <tt>EventListener</tt> objects with a catch of 
<tt>Throwable</tt></strong>

<p/>All calls to <tt>EventListener</tt> objects should be wrapped in a catch of 
<tt>Throwable</tt>. Don't let the listeners you call on your thread cause your 
thread to die due an uncaught failure.

<p/><pre><tt>
try {
  listener.receiveMessage( mfs.msg );
} catch (Throwable ignored) {
  if ( LOG.isEnabledFor(Priority.ERROR) ) {
    LOG.error( "Uncaught Throwable in listener : " + listener.getName() +
      "(" + listener.getClass().getName() + ")" , ignored );
  }
}
</tt><pre></li>

<li><strong>Don't catch <tt>Exception</tt></strong>

<p/>Catching Exception catches RuntimeException (due to the bizarre way that
checked and unchecked exceptions work in Java).  Correct programs generally
should never throw RuntimeExceptions.  You wouldn't continue a C program
after dereferencing a null pointer, would you? Additionally, catching
<tt>Exception</tt> does not catch <tt>Error</tt>s.

<p/>Catch specific exceptions and rethrow <tt>RuntimeException</tt> or catch
<tt>Throwable</tt> if you really meant to catch everything.

<p/><pre><tt>
try {
   ... your code ...
} catch ( RuntimeException ex ) {
   throw ex;
} catch ( Exception ex ) {
   ... recover ...
}
</tt><pre></li>

<li><strong>Log Exceptional Events</strong>

<p/>Nearly every exception <tt>catch</tt> should include a logging statement. 
If you rethrow the same exception then its probably OK to not log. Silently 
"eating" exceptions,i.e. <tt>catch( SomeException ex ) {;}</tt> is strongly
discouraged.
</li>

<li><strong>Addition to "10.5.4 Special Comments"</strong>

<p/>The <a href="http://java.sun.com/docs/codeconv/">Code Conventions for the Java<sup><font size="-2">TM</font></sup> Programming Language</a>
define special tags XXX, HACK or FIXME for comments. All use of these should
include both the date in a recognizable form (07/08/02 is bad because its 
ambiguous, 20020807 is good) and your JXTA user id. Please use your JXTA user id 
because its also your CVS name which helps a lot figuring out who did things.

<p/><pre><tt>
// FIXME 20020301 bondolo This example could be improved.
</tt><pre></li>

</ol>
</body>
</html>
